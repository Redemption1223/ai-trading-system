{% extends "base.html" %}

{% block title %}Settings - AGI Trading System{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-header">
        <h2>‚öôÔ∏è System Settings</h2>
        <p>Configure your AGI Trading System</p>
    </div>

    <div class="settings-panels">
        <!-- MT5 Connection Settings -->
        <div class="settings-panel">
            <div class="panel-header">
                <h3>üîå MT5 Connection</h3>
            </div>
            <div class="panel-content">
                <div class="setting-group">
                    <label for="broker-name">Broker:</label>
                    <select id="broker-name">
                        <option value="FxPro">FxPro</option>
                        <option value="FXTM">FXTM</option>
                        <option value="XM">XM</option>
                        <option value="IC Markets">IC Markets</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="account-type">Account Type:</label>
                    <select id="account-type">
                        <option value="demo">Demo Account</option>
                        <option value="live">Live Account</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="auto-connect">
                        <input type="checkbox" id="auto-connect" checked>
                        Auto-connect on startup
                    </label>
                </div>
                
                <div class="setting-group">
                    <label for="connection-timeout">Connection Timeout (seconds):</label>
                    <input type="number" id="connection-timeout" value="30" min="10" max="120">
                </div>
            </div>
        </div>

        <!-- Risk Management Settings -->
        <div class="settings-panel">
            <div class="panel-header">
                <h3>‚ö†Ô∏è Risk Management</h3>
            </div>
            <div class="panel-content">
                <div class="setting-group">
                    <label for="max-risk">Max Risk Per Trade (%):</label>
                    <input type="number" id="max-risk" value="2" min="0.1" max="10" step="0.1">
                </div>
                
                <div class="setting-group">
                    <label for="max-daily-loss">Max Daily Loss (%):</label>
                    <input type="number" id="max-daily-loss" value="5" min="1" max="20" step="0.5">
                </div>
                
                <div class="setting-group">
                    <label for="max-positions">Max Open Positions:</label>
                    <input type="number" id="max-positions" value="5" min="1" max="20">
                </div>
                
                <div class="setting-group">
                    <label for="position-sizing">Position Sizing Method:</label>
                    <select id="position-sizing">
                        <option value="fixed_fractional">Fixed Fractional</option>
                        <option value="kelly">Kelly Criterion</option>
                        <option value="optimal_f">Optimal F</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Agent Configuration -->
        <div class="settings-panel">
            <div class="panel-header">
                <h3>ü§ñ Agent Configuration</h3>
            </div>
            <div class="panel-content">
                <div class="agent-settings">
                    <div class="agent-item">
                        <div class="agent-info">
                            <span class="agent-name">Neural Signal Brain</span>
                            <span class="agent-status">Template</span>
                        </div>
                        <div class="agent-controls">
                            <label>
                                <input type="checkbox" checked> Enabled
                            </label>
                            <label>
                                Weight: <input type="number" value="1.0" step="0.1" min="0" max="2">
                            </label>
                        </div>
                    </div>
                    
                    <div class="agent-item">
                        <div class="agent-info">
                            <span class="agent-name">Technical Analyst</span>
                            <span class="agent-status">Template</span>
                        </div>
                        <div class="agent-controls">
                            <label>
                                <input type="checkbox" checked> Enabled
                            </label>
                            <label>
                                Weight: <input type="number" value="0.8" step="0.1" min="0" max="2">
                            </label>
                        </div>
                    </div>
                    
                    <div class="agent-item">
                        <div class="agent-info">
                            <span class="agent-name">News Sentiment Reader</span>
                            <span class="agent-status">Template</span>
                        </div>
                        <div class="agent-controls">
                            <label>
                                <input type="checkbox" checked> Enabled
                            </label>
                            <label>
                                Weight: <input type="number" value="0.6" step="0.1" min="0" max="2">
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- UI Preferences -->
        <div class="settings-panel">
            <div class="panel-header">
                <h3>üé® UI Preferences</h3>
            </div>
            <div class="panel-content">
                <div class="setting-group">
                    <label for="theme-select">Theme:</label>
                    <select id="theme-select">
                        <option value="professional_dark">Professional Dark</option>
                        <option value="light">Light Theme</option>
                        <option value="blue">Blue Theme</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="refresh-rate">Dashboard Refresh Rate (ms):</label>
                    <input type="number" id="refresh-rate" value="1000" min="100" max="10000" step="100">
                </div>
                
                <div class="setting-group">
                    <label for="sound-alerts">
                        <input type="checkbox" id="sound-alerts" checked>
                        Enable Sound Alerts
                    </label>
                </div>
                
                <div class="setting-group">
                    <label for="popup-alerts">
                        <input type="checkbox" id="popup-alerts" checked>
                        Enable Popup Notifications
                    </label>
                </div>
            </div>
        </div>

        <!-- Trading Symbols -->
        <div class="settings-panel">
            <div class="panel-header">
                <h3>üìà Trading Symbols</h3>
            </div>
            <div class="panel-content">
                <div class="symbol-list">
                    <div class="symbol-item">
                        <label>
                            <input type="checkbox" checked> EUR/USD
                        </label>
                        <span class="symbol-info">Major - Low spread</span>
                    </div>
                    <div class="symbol-item">
                        <label>
                            <input type="checkbox" checked> GBP/USD
                        </label>
                        <span class="symbol-info">Major - Volatile</span>
                    </div>
                    <div class="symbol-item">
                        <label>
                            <input type="checkbox" checked> USD/JPY
                        </label>
                        <span class="symbol-info">Major - Trending</span>
                    </div>
                    <div class="symbol-item">
                        <label>
                            <input type="checkbox"> AUD/USD
                        </label>
                        <span class="symbol-info">Major - Commodity</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Actions -->
    <div class="settings-actions">
        <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
        <button class="btn btn-secondary" onclick="resetSettings()">üîÑ Reset to Defaults</button>
        <button class="btn btn-success" onclick="testConnection()">üß™ Test MT5 Connection</button>
    </div>

    <!-- Status Messages -->
    <div id="settings-status" class="status-messages" style="display: none;">
        <div class="status-message">Settings saved successfully!</div>
    </div>
</div>

<style>
.settings-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.settings-header {
    text-align: center;
    margin-bottom: 30px;
}

.settings-header h2 {
    margin: 0;
    color: var(--text-primary);
}

.settings-header p {
    color: var(--text-secondary);
    margin-top: 5px;
}

.settings-panels {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.settings-panel {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}

.panel-header {
    background-color: var(--bg-primary);
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
}

.panel-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 16px;
}

.panel-content {
    padding: 20px;
}

.setting-group {
    margin-bottom: 20px;
}

.setting-group label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-primary);
    font-size: 14px;
}

.setting-group input,
.setting-group select {
    width: 100%;
    padding: 8px 12px;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
}

.setting-group input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
}

.agent-settings {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.agent-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background-color: var(--bg-primary);
    border-radius: 6px;
}

.agent-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.agent-name {
    font-weight: bold;
    color: var(--text-primary);
}

.agent-status {
    font-size: 12px;
    color: var(--text-secondary);
}

.agent-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
    text-align: right;
}

.agent-controls label {
    margin: 0;
    font-size: 12px;
}

.agent-controls input[type="number"] {
    width: 60px;
    padding: 4px;
}

.symbol-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.symbol-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: var(--bg-primary);
    border-radius: 4px;
}

.symbol-info {
    font-size: 12px;
    color: var(--text-secondary);
}

.settings-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-success {
    background-color: #28a745;
    color: white;
}

.btn:hover {
    opacity: 0.9;
}

.status-messages {
    text-align: center;
}

.status-message {
    display: inline-block;
    padding: 12px 20px;
    background-color: #28a745;
    color: white;
    border-radius: 6px;
    margin: 5px;
}
</style>
{% endblock %}

{% block scripts %}
<script>
function saveSettings() {
    // Collect all settings
    const settings = {
        mt5: {
            broker: document.getElementById('broker-name').value,
            accountType: document.getElementById('account-type').value,
            autoConnect: document.getElementById('auto-connect').checked,
            timeout: parseInt(document.getElementById('connection-timeout').value)
        },
        risk: {
            maxRisk: parseFloat(document.getElementById('max-risk').value),
            maxDailyLoss: parseFloat(document.getElementById('max-daily-loss').value),
            maxPositions: parseInt(document.getElementById('max-positions').value),
            positionSizing: document.getElementById('position-sizing').value
        },
        ui: {
            theme: document.getElementById('theme-select').value,
            refreshRate: parseInt(document.getElementById('refresh-rate').value),
            soundAlerts: document.getElementById('sound-alerts').checked,
            popupAlerts: document.getElementById('popup-alerts').checked
        }
    };

    // Show status message
    const statusDiv = document.getElementById('settings-status');
    statusDiv.style.display = 'block';
    
    setTimeout(() => {
        statusDiv.style.display = 'none';
    }, 3000);

    console.log('Settings saved:', settings);
    
    // In Phase 2, this will send settings to the backend
    // fetch('/api/settings', { method: 'POST', body: JSON.stringify(settings) })
}

function resetSettings() {
    if (confirm('Reset all settings to defaults? This cannot be undone.')) {
        // Reset form values
        document.getElementById('max-risk').value = 2;
        document.getElementById('max-daily-loss').value = 5;
        document.getElementById('max-positions').value = 5;
        document.getElementById('refresh-rate').value = 1000;
        
        console.log('Settings reset to defaults');
    }
}

function testConnection() {
    const statusDiv = document.getElementById('settings-status');
    statusDiv.innerHTML = '<div class="status-message" style="background-color: #ffc107; color: #000;">Testing MT5 connection...</div>';
    statusDiv.style.display = 'block';
    
    // Simulate connection test
    setTimeout(() => {
        statusDiv.innerHTML = '<div class="status-message" style="background-color: #fd7e14; color: #fff;">MT5 connection test: Template mode - Implementation in Phase 2</div>';
        
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 5000);
    }, 2000);
}

// Load saved settings on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('Settings page loaded - Template mode');
});
</script>
{% endblock %}